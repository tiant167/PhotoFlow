"use strict";function apiHelper(a){function b(a,b){var c=b.param;return c?(delete b.param,_.isObject(c)?_.each(c,function(b,c){a=a.replace(":"+c,b)}):_.each(c,function(b){a=a.replace(/:[^/]+/,b)}),a):a}function c(c,f){var g=d[c];return f=f||{},a(_.extend({method:g.split(" ")[0],url:e+b(g.split(" ")[1],f)},f))}var d={},e="";return c.config=function(a){d=_.extend(d,a)},c}angular.module("photoFlowApp",["ngRoute","photoFlowApp.base.services.api","ngSanitize","btford.markdown"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"PictureCtrl"}).when("/blog",{templateUrl:"views/blog.html",controller:"BlogCtrl"}).when("/article/:id",{templateUrl:"views/article.html",controller:"ArticleCtrl"}).otherwise({redirectTo:"/"})}]);var $notice={success:function(){},error:function(){}};angular.module("photoFlowApp.base.services.api",[]).factory("apiHelper",["$http",apiHelper]).factory("apiHelperInterceptor",["$q",function(a){return{responseError:function(b){return b.config.url.indexOf("/api/")>-1&&$notice.error("error-"+b.status+": "+(b.config.url||"")+", 接口出问题啦!"),a.reject(b)},response:function(a){return a.config.url.indexOf("/api/")>-1&&"POST"===a.config.method&&$notice.success("操作成功！"),a}}}]).config(["$httpProvider",function(a){a.interceptors.push("apiHelperInterceptor")}]),angular.module("photoFlowApp").controller("MainCtrl",["$scope","apiHelper",function(a,b){var c="/api",d={getWebsiteConf:"GET "+c+"/website/conf/"};b.config(d),b("getWebsiteConf").then(function(b){a.websiteConfig=b.data})}]),angular.module("photoFlowApp").controller("BlogCtrl",["$scope","apiHelper",function(a,b){var c="/api",d={getBlogList:"GET "+c+"/blog/list/"};b.config(d),b("getBlogList").then(function(b){a.blogsList=b.data})}]),angular.module("photoFlowApp").controller("ArticleCtrl",["$scope","apiHelper","$routeParams","$location",function(a,b,c,d){var e="/api",f={getBlog:"GET "+e+"/blog/article/:id/"};b.config(f),b("getBlog",{param:{id:c.id}}).then(function(b){a.blog=b.data,a.markdown=b.data.content}),a.jumpToURL=function(a){d.path(a)}}]),angular.module("photoFlowApp").controller("PictureCtrl",["$scope","apiHelper",function(a,b){var c="/api",d={getPictureList:"GET "+c+"/picture/list/"};b.config(d),b("getPictureList").then(function(b){a.pictures=b.data;var c=[],d=[];angular.forEach(a.pictures,function(a){a.long?d.push(a):c.push(a)});for(var e=0;e<d.length;e++){var f=d[e];c.length<4*e+3?c.splice(4*e-1,0,f):c.splice(4*e+3,0,f)}a.pictures=c})}]);